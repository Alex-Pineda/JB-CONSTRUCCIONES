<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Editar Proyecto - Portafolio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="../assets/css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
    }
    #currentImages img,
    #previewContainer img {
      max-width: 100px;
      max-height: 100px;
      object-fit: cover;
      border-radius: 0.5rem;
      border: 1px solid #161a7e;
    }
    </style>
</head>

<body class="bg-gray-50 h-screen">
  <div class="flex min-h-screen">
    <div class="flex-1 flex flex-col overflow-hidden">

      <!-- Encabezado -->
      <header class="bg-transparent border-b-[3px] border-[#161a7e] shadow-none">
        <div class="flex items-center justify-between px-3 py-3">
          <h1 class="text-xl font-semibold text-gray-800">Modificar Proyecto Existente</h1>
          <button onclick="window.location.href='../index.html'" class="px-3 py-1 bg-yellow-500 text-white rounded-lg text-sm hover:bg-red-700 transition duration-200">Inicio</button>
        </div>
      </header>

      <!-- Contenido principal -->
      <main class="flex-1 overflow-y-auto bg-gray-100 scroll-smooth">
        <!-- Envoltura sin centrado, ocupa toda la pantalla -->
          <div class="w-full h-full py-4 px-0">
          <!-- Contenedor general ajustado -->
          <div class="border-[3px] border-[#161a7e] rounded-xl p-4 bg-[#f7f7f738] shadow-md w-full h-full flex flex-col flex-1 min-h-0">
            <form id="editForm" class="flex flex-col gap-6 flex-1 min-h-0">

              <!-- Cuerpo del formulario -->
              <div class="flex flex-col lg:flex-row gap-6 flex-1 min-h-0">

               <!-- Columna izquierda -->
<div class="w-full lg:w-1/2 flex flex-col flex-1 min-h-0 border-[2px] border-[#161a7e] rounded-lg p-4 space-y-6 justify-evenly items-center overflow-auto">

  <!-- Título y Estado -->
  <div class="flex flex-col lg:flex-row gap-3 w-full max-w-[600px]">
    
    <!-- Campo: Título del Proyecto -->
    <div class="w-full lg:w-2/3">
      <label for="titulo" class="block font-medium text-gray-800 mb-1 text-lg">Título del Proyecto</label>
      <input 
        id="titulo"
        type="text"
        name="titulo"
        class="w-full px-2 py-1 border border-[#161a7e] rounded-lg bg-[#f7f7f76e] text-gray-800 focus:outline-none focus:ring-2 focus:ring-[#161a7e]"
        value="Proyecto de Ejemplo"
        required>
    </div>

    <!-- Campo: Estado -->
    <div class="w-full lg:w-1/3">
      <label for="estado" class="block font-medium text-gray-800 mb-1 text-lg">Estado</label>
      <select
        id="estado"
        name="estado"
        class="w-full px-2 py-1 border border-[#161a7e] rounded-lg bg-[#f7f7f76e] text-gray-800 focus:outline-none focus:ring-2 focus:ring-[#161a7e]"
        required>
        <option value="" disabled selected>Elegir estado</option>
        <option value="borrador">Borrador</option>
        <option value="publicado">Publicado</option>
      </select>
    </div>
  </div>

  <!-- Descripción -->
  <div class="w-full max-w-[600px]">
    <label for="descripcion" class="block font-medium text-gray-800 mb-1 text-center text-lg">Descripción del Proyecto</label>
    <textarea
      id="descripcion"
      name="descripcion"
      class="w-full px-2 py-1 min-h-[100px] border border-[#161a7e] rounded-lg bg-[#f7f7f76e] text-gray-800 focus:outline-none focus:ring-2 focus:ring-[#161a7e]"
      required>Descripción del proyecto...</textarea>  
  </div>

  <!-- Fila con 2 selects -->
  <div class="flex flex-col lg:flex-row gap-3 w-full max-w-[600px]">
    
    <!-- Campo: Categoría -->
    <div class="w-full lg:w-1/2">
      <label for="categoria" class="block font-medium text-gray-800 mb-1 text-lg">Categoría</label>
      <select
        id="categoria"
        name="categoria"
        class="w-full px-2 py-1 border border-[#161a7e] rounded-lg bg-[#f7f7f76e] text-gray-800 focus:outline-none focus:ring-2 focus:ring-[#161a7e]"
        required>
        <option value="">Seleccionar Categoría</option>
        <option value="obra_blanca">Obra Blanca</option>
        <option value="obra_negra">Obra Negra</option>
        <option value="mantenimiento">Mantenimiento</option>
      </select>
    </div>

    <!-- Campo: Tipo de Servicio -->
    <div class="w-full lg:w-1/2">
      <label for="tipo_servicio" class="block font-medium text-gray-800 mb-1 text-lg">Tipo de Servicio</label>
      <select
        id="tipo_servicio"
        name="tipo_servicio"
        class="w-full px-2 py-1 border border-[#161a7e] rounded-lg bg-[#f7f7f76e] text-gray-800 focus:outline-none focus:ring-2 focus:ring-[#161a7e]"
        required>
        <option value="">Seleccionar Servicio</option>
        <option value="construccion">Construcción</option>
        <option value="remodelacion">Remodelación</option>
        <option value="asesoria">Asesoría</option>
      </select>
    </div>
  </div>

  <!-- Imágenes actuales -->
  <div class="w-full max-w-[600px]">
    <label class="block font-medium text-gray-800 mb-1 text-center text-lg">Imágenes Actuales</label>
    <div 
      id="currentImages"
      class="flex flex-wrap gap-3 justify-center items-center max-w-full overflow-auto max-h-64 rounded-lg p-2 bg-[#f7f7f726]">
      <!-- Se insertan por JS -->
    </div>
  </div>

</div> <!-- Fin columna izquierda -->

                <!-- Columna derecha -->
                <div class="w-full lg:w-1/2 flex flex-col flex-1 min-h-0 border-[2px] border-[#161a7e] rounded-lg p-4 space-y-6 justify-evenly overflow-auto">

                  <!-- Nuevas imágenes -->
                  <div class="w-full">
                    <label class="block font-medium text-gray-800 mb-1 text-lg text-center">Agregar Nuevas Imágenes</label>
                    <input 
                      type="file" 
                      id="newImagesInput" 
                      name="imagenes[]" 
                      multiple 
                      accept="image/*"
                      class="w-full border-[1px] border-[#161a7e] px-2 py-1 rounded-lg bg-[#f0f4ff] text-gray-800">
                    <small class="text-gray-500 block mt-1 text-center">Puedes seleccionar varias imágenes (máximo 4).</small>
                    <p id="imageCount" class="text-sm text-blue-600 mt-1 hidden text-center"></p>

                    <div 
                      id="previewContainer" 
                      class="flex flex-wrap gap-3 justify-center mt-3 overflow-auto max-w-full max-h-64">
                      <!-- Imágenes cargadas dinámicamente -->
                    </div>
                  </div>

                  <!-- Botones -->
                  <div class="flex justify-center gap-6 pt-4 w-full">
                    <button type="button" onclick="window.location.href='portafolio.html'" class="w-40 px-6 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500">
                      Cancelar
                    </button>
                    <button type="submit" class="w-40 px-6 py-2 bg-[#161a7e] text-white rounded-lg hover:bg-[#0f1457]">
                      Actualizar
                    </button>
                  </div>

                </div> <!-- Fin columna derecha -->

              </div> <!-- Fin del cuerpo del formulario -->

            </form>
          </div>
        </div>
      </main>
    </div>
  </div>
</body>

  <!-- Scripts -->
<script>
  const imagenesActuales = [
    "https://picsum.photos/id/1011/200/150",
    "https://picsum.photos/id/1012/200/150",
    "https://picsum.photos/id/1013/200/150",
    "https://picsum.photos/id/1015/200/150"
  ];

  const currentImagesContainer = document.getElementById("currentImages");
  const newImagesInput = document.getElementById("newImagesInput");
  const previewContainer = document.getElementById("previewContainer");
  const imageCount = document.getElementById("imageCount");

  // Para manejar los archivos seleccionados dinámicamente
      let archivosSeleccionados = [];

      // Función reutilizable para crear imagen con botón de eliminar
      function crearVistaPreviaImagen(src, contenedor, onDelete) {
      const wrapper = document.createElement("div");
      wrapper.className = "relative group inline-block";

      const img = document.createElement("img");
      img.src = src;
      img.className = "w-28 h-20 object-cover rounded border";

      const deleteBtn = document.createElement("button");
      deleteBtn.type = "button";
      deleteBtn.innerHTML = "✕";
      deleteBtn.className = "absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center opacity-0 group-hover:opacity-100 transition duration-200";
      deleteBtn.title = "Eliminar imagen";

      deleteBtn.addEventListener("click", () => {
        wrapper.remove();
        onDelete?.(); // Ejecuta callback si se pasó
      });

      wrapper.appendChild(img);
      wrapper.appendChild(deleteBtn);
      contenedor.appendChild(wrapper);
    }


  // Mostrar imágenes actuales (simuladas desde backend)
  imagenesActuales.forEach(src => {
    crearVistaPreviaImagen(src, currentImagesContainer);
  });

  // Manejar nuevas imágenes seleccionadas
  newImagesInput.addEventListener("change", () => {
    const files = Array.from(newImagesInput.files);
    archivosSeleccionados = files.slice(0, 4); // Solo permitir hasta 4

    previewContainer.innerHTML = ""; // Limpiar previews anteriores

    // Mostrar previews con opción a eliminar
    archivosSeleccionados.forEach((file, index) => {
      const reader = new FileReader();
      reader.onload = e => {
        crearVistaPreviaImagen(e.target.result, previewContainer, () => {
          // Eliminar el archivo de la lista y actualizar input
          archivosSeleccionados.splice(index, 1);
          actualizarInputFiles();
        });
      };
      reader.readAsDataURL(file);
    });
  });

  // Actualiza el input de archivos usando DataTransfer
  function actualizarInputFiles() {
    const dataTransfer = new DataTransfer();
    archivosSeleccionados.forEach(file => dataTransfer.items.add(file));
    newImagesInput.files = dataTransfer.files;

    // Actualizar contador visual
    if (archivosSeleccionados.length > 0) {
      imageCount.textContent = `Imágenes seleccionadas: ${archivosSeleccionados.length}`;
      imageCount.classList.remove("hidden");
    } else {
      imageCount.classList.add("hidden");
    }
  }

  // Validación al enviar el formulario
  document.getElementById("editForm").addEventListener("submit", function (e) {
    if (archivosSeleccionados.length > 4) {
      e.preventDefault();
      alert("❌ Solo puedes subir hasta 4 imágenes.");
      return;
    }

    e.preventDefault();
    alert("✅ Proyecto actualizado correctamente (simulado).");
    window.location.href = "portafolio.html";
  });
</script>
</body>
</html>
